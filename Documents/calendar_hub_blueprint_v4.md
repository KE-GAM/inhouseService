# 📌 Calendar Hub — Blueprint (for Cursor) — v4

## 0) 문서 목적
- **개발자가 API/코드 없이도 바로 작업 분할이 가능**하도록 하는 기능 명세서.
- 과제 환경: **실 HRIS 연동 대신 더미 HRIS** 사용.
- 세 캘린더는 **완전 분리**: `My`, `Vacation`, `Official`.  
- `Vacation`/`Official` → `My` 로는 **“구독(Subscribe)”만** 허용. (복사/가져오기 없음)

---

## 1) 범위(스코프)

### 포함
- Calendar Hub 진입/탭 구조/페이지 전환
- 세 캘린더의 **독립적 표시**(월/주/일 공통 뷰)
- `Vacation`/`Official` 이벤트 **구독 생성/해제/연결해제(Unlink) UX**
- **원본 변경/취소 시 구독 이벤트 자동 반영** 규칙
- **Vacation 팀 단위 표시**, 최초 진입 시 **사용자 소속팀 기본 선택**
- **더미 HRIS 데이터 세트/동기화 시나리오**

### 제외
- 외부 캘린더(Google/Outlook) 연동. 하지만 추후 연동 가능성을 염두에 두고 프로그래밍 할 것.
- 실시간 푸시(웹소켓) * 필요 시 폴링/진입 시 동기화로 대체
- 복잡한 권한 매트릭스(필요 최소한만)

---

## 2) 사용자 & 사용 시나리오

### 사용자 유형
- 일반 직원(USER): 자신의 `My` 관리, `Vacation/Official` 조회 및 **구독**
- HR/운영(HR/ADMIN): `Official` 일정 작성/변경/취소, **더미 HRIS 동기화 트리거**(수동 버튼 또는 사전 주입 스크립트)

### 핵심 시나리오
1. **내 캘린더 확인**: Hub → 기본 `My` 탭에서 오늘/이번 주 일정 확인
2. **팀 휴가 보기**: `Vacation` 탭 → 첫 진입 시 *내 소속팀(home_org)* 자동 선택 → 팀원 휴가만 보임
3. **공식 행사 구독**: `Official` 탭에서 행사 카드를 **구독** → `My`에 나타남(🔗 배지)
4. **원본 취소 반영**: 공식 행사가 취소되면, 구독된 `My` 일정이 **자동 제거**(또는 ‘취소됨’ 표시 정책 — **본문 8 참고**)

---

## 3) 정보구조(IA) & 내비게이션

- 사이드바: `Calendar Hub` 메뉴 → 기본 진입은 `My`
- 상단 탭: `My | Vacation | Official`
- 상단은 두 개의 바로 구성된다: **Primary Navigation Bar**(공통: Prev/Today/Next, Date picker, Month·Week·Day, **새로고침**, **+ New Event**) + **Context Filter Bar**(Vacation=팀 드롭다운·생일 토글 / My·Official=없음).
- **+ New Event** 버튼은 현재 탭 컨텍스트로 동작한다: **My=개인 이벤트 생성**, **Official=공식 이벤트 생성**(HR/Admin만 노출), **Vacation=비노출**.
- `view`, `date`, `org`, `showBirthdays`는 **URL 파라미터로 상태 동기화**한다(예: `?view=week&date=2025-09-21&org=ENG-BE&showBirthdays=0`).

---

## 4) 화면/컴포넌트 요구사항

### 공통(Calendar View)
- 월/주/일 전환(**기본: 주(Week) 뷰**)
- 이벤트 카드: 제목, 시간, 위치(있다면), 소속(Official/Vacation 타입) 라벨
- 툴팁/모달: 상세 정보(시간/이름/유형/설명)
- 필터/검색: 키워드(선택), 기간은 네비게이션으로 대체

### My Calendar
- 내 일정 **생성/수정/삭제**
- 상단 **+ New Event** 클릭 시 My 이벤트 생성 모달을 연다(공통 모달 재사용).
- 이후 생성된 이벤트를 클릭하면 해당 이벤트에 대한 상세 내용과 수정, 삭제를 할 수 있다.
- **구독 이벤트는 편집 불가**(제목/시간). 카드에 **🔗 Linked** 배지
- **Context Filter Bar는 표시하지 않는다**(행 자체 숨김).
- 구독 이벤트 컨텍스트 메뉴:
  - **Unsubscribe**: 내 캘린더에서 제거
  - **Unlink**: 연결 해제 → 독립 일정으로 전환(이후 원본과 동기화 없음)
- 자동 동기화 트리거:
  - 페이지 진입/새로고침 시 1회
  - 간단 **새로고침** 버튼

### Vacation Calendar
- **조회 전용**
- 상단: **공통 네비 바** + (아래) **Context Filter Bar**(팀 선택 드롭다운, **[ ] 생일자 보기** 토글)
- **최초 진입 시 사용자 소속팀(home_org) 자동 선택**(회사에 복수 소속이 없다면 단일 `org_code`를 사용)
- 복수 소속을 운용하는 조직이라면, HRIS의 **home_org(주 소속)** 를 기본으로 하고, 없으면 사용자가 처음 방문 시 직접 선택 → **사용자 설정(default_org)으로 저장**.
- 이벤트를 클릭하면 popover 창이 뜨고 **구독하기** 버튼
- 이벤트는 **휴가자 이름과 기간만** 노출(사유/휴가 종류 등은 **비노출**)

### Official Event Calendar
- 일반 유저: **조회+구독**만
- HR/ADMIN: 생성/수정/취소/삭제 액션
- 공식 일정 생성은 상단 공통 **+ New Event**로 수행하며, 모달은 동일 컴포넌트를 사용하되 **Scope=Official 고정**. 이 버튼은 HR/Admin에게만 노출된다.
- 카드에 상태 라벨: `Scheduled` / `Cancelled`

---

## 5) 구독 모델 규칙(핵심)

- `Vacation/Official` → `My`로 **구독**만 허용 (가져오기/복사 없음)
- **동기화 규칙**
  1) 원본 **시간 변경** → `My`의 해당 구독 일정도 **자동 수정**
  2) 원본 **취소/삭제** → `My`의 해당 구독 일정 **자동 제거**  
     - *대안 정책*: 제거 대신 `Cancelled` 스타일로 남기기 — 프로젝트 설정값으로 선택
  3) `My`에서의 **사용자 메모**는 별도 필드로 보존(동기화 영향 없음)
- **연결 해제(Unlink)**: 현재 값으로 고정된 **독립 일정**으로 전환(이후 원본을 따라가지 않음)
- **중복 구독 허용**: 같은 원본을 각기 다른 사용자가 여러 번 구독 가능(단, UI에서 “이미 구독함” 배지/툴팁 제공 권장)

---

## 6) Vacation — 팀 단위 정책

### 6-1) 팀 결정 로직(최초 진입)
- 로그인 사용자의 **소속팀(home_org)** 을 기본값으로 사용한다. (복수 소속을 쓰지 않는 회사라면 단일 `org_code`가 곧 home_org)
- 만약 여러 소속이 있고 **home_org 표식**이 없다면:
  1) HRIS의 `home_department`/`payroll_department` 유사 필드 우선  
  2) 없으면 **최초 방문 시 사용자에게 선택**받고 `default_org`로 저장  
  3) 그마저 없으면 상위 조직 → `All Teams` 순으로 폴백
- 기본 선택은 UI 상단 드롭다운에 반영

### 6-2) 표시/상호작용
- 기본: **선택된 팀의 일정만** 보이도록 (전사 단위는 Too much noise → 사용자가 명시적으로 선택)
- 팀 변경 시 즉시 **새로고침**
- **구독하기** 버튼: 카드/툴팁에 고정 노출

---

## 7) 더미 HRIS — 과제용 데이터/시나리오

### 7-1) 데이터 원칙
- 더미 HRIS는 **단일 진실 소스(SSOT) 역할**을 흉내냄
- 필드(예시):  
  - `hris_id`, `employee_no`, `name`, `org_code`, `type(PTO/HALF/SICK/WFH)`,  
  - `start_at`, `end_at`, `status(ACTIVE/CANCELLED)`, `updated_at`
- 스냅샷 파일(JSON/CSV) 1개 이상 제공
  - **시나리오 A**: 정상 연차
  - **시나리오 B**: 반차
  - **시나리오 C**: **조기 복귀(취소/단축)** 케이스 포함 — *구독 동기화 확인용*
  - **시나리오 D**: 팀 간 분산(ENG-BE, ENG-FE, HR 등)

### 7-2) 동기화 플로우(개념)
- HR/ADMIN이 **동기화 버튼**을 누르면 더미 파일을 읽어 `Vacation` 캘린더 데이터가 갱신됨
- `status`와 `updated_at`을 기반으로 변경/취소를 반영
- `Vacation`의 변경은 다음 조건에서 `My` 구독 이벤트에 전파됨:
  - **사용자 진입 시 자동 동기화 1회**  
  - (선택) 일정 주기 폴링/수동 **새로고침**

---

## 8) 상태/라이프사이클

### 이벤트 상태
- `Scheduled` / `Cancelled` (Vacation/Official 원본)
- `My` 구독 이벤트는 원본 상태만 따르며, **삭제 정책** 선택:
  - **기본 권장**: 원본 취소/삭제 ⇒ `My`에서 **자동 제거**
  - 옵션: `Cancelled`로 표시 유지(회색/취소선)

### 액션 결과 피드백
- 구독 성공: “내 캘린더에 구독되었습니다(원본 변경/취소 시 자동 반영)”
- 자동 제거: “원본 취소로 내 캘린더에서 제거되었습니다”
- Unlink: “연결이 해제되어 독립 일정으로 전환되었습니다(이후 원본과 동기화되지 않음)”
- Unsubscribe: “구독이 해지되어 내 캘린더에서 제거되었습니다”

---

## 9) 권한(간단)

- `My`: 로그인 사용자 본인만 CRUD  
- `Vacation`: 전사 조회(기본), **수정 불가**, 구독 가능  
- `Official`: HR/ADMIN만 작성/변경/취소, 전사 조회/구독 가능

---

## 10) 성능/안정성/보안 (NFR)

- **기간 제한 조회** 필수(예: 뷰 범위 ± 몇 주)
- Vacation 전사 조회 방지: **팀 필터 기본 적용**
- 동시성: 동기화 중 중복 실행 방지(간단한 락/토글)
- 개인정보: Vacation 상세 사유/메모는 기본 **비노출**
- 감사 가능성: `Official` 변경(생성/수정/취소), `Vacation` 동기화, 구독/해제/연결해제 로그 남길 수 있도록 **훅 포인트**만 정의
- 시간대는 **Asia/Seoul** 기준으로 저장/표시한다(외부 연동 시에도 내부 표준 유지). 주간 범위는 **월~일**.
- 이벤트는 **source_type/source_id/source_version** 메타를 공통으로 가진다.
- **사용자 설정**: 최초 선택한 팀을 `default_org`로 저장/복원한다.
- 삭제/취소 정책: 원본 취소/삭제 ⇒ 구독 측 **자동 제거**(현재 정책 유지).

---

## 11) 수용 기준(Acceptance Criteria)

1. Hub 진입 시 `My` 탭이 열린다.  
2. `Vacation` 탭 진입 시 **사용자 소속팀(home_org 또는 default_org)** 이 기본 선택된다.  
3. `Vacation`/`Official` 카드에서 **구독하기** 클릭 시 `My`에 즉시 표시되며 **🔗 배지**가 보인다.  
4. 원본 일정의 시간이 바뀌면, `My`의 구독 일정도 **동일하게 바뀐다**(화면 전환/새로고침/동기화 시점).  
5. 원본이 취소/삭제되면, `My`의 구독 일정은 **자동 제거**된다(또는 프로젝트 정책에 맞는 취소 표기).  
6. `Unlink` 시 구독 표식이 사라지고, 이후 원본 변경/취소의 영향을 받지 않는다.  
7. `Vacation`은 전사 단위가 아닌 **팀 필터**가 기본 적용된다(수동으로 All Teams 선택 가능).  
8. 더미 HRIS의 **조기 복귀/취소** 케이스가 동기화 후 `My`에서 올바르게 반영된다.  
9. Vacation에서 **생일자 보기 토글 ON/OFF**가 즉시 반영된다(기간 쿼리는 동일, 표시만 제어).  
10. 상단 **+ New Event**는 탭 컨텍스트 기반으로 동작한다(Official 탭에선 HR/Admin만 노출).  
11. 동일 모달 컴포넌트를 사용하되, Official 생성 시 **Scope=Official 고정**이다.  
12. Official 탭에는 **조직/카테고리 필터가 존재하지 않는다**(전사 공지 단일 캘린더).

---

## 12) 테스트 시나리오(샘플)

- **T1**: `Vacation(ENG-BE)`에 A, B의 연차가 노출되는지 확인  
- **T2**: B의 반차가 **같은 날 오전**으로만 표시되는지 확인  
- **T3**: C의 휴가 **조기 복귀** 더미 반영 후, C의 일정이 `My`에서 **자동 제거**되는지(구독 상태)  
- **T4**: `Official` 행사 X를 구독 후, 시간이 14→15시로 바뀌면 `My`도 15시로 바뀌는지  
- **T5**: 구독 이벤트에서 **Unlink** 후, 원본 시간이 다시 바뀌어도 `My` 일정이 **그대로** 유지되는지  
- **T6**: `Vacation` 첫 진입 시 사용자의 **home_org 또는 default_org**가 기본 선택되는지  
- **T7**: `Vacation`에서 **All Teams** 선택 시 전사 일정이 표시되는지(성능·가독성 확인)  
- **T8**: Vacation에서 **생일 토글 ON 시 팀원 생일이 표시되고, OFF 시 즉시 숨겨진다**.  
- **T9**: Official 탭에 **조직/카테고리 필터가 없음을** 확인(전사 공지 단일 캘린더).

---

## 13) 작업 체크리스트(개발 분담 기준)

- [ ] Hub 탭/라우팅 구성 (`My/Vacation/Official`)
- [ ] 공통 달력 컴포넌트(월/주/일) + 이벤트 카드 + 툴팁/모달
- [ ] `Vacation` 팀 드롭다운 + **초기값 자동 선택 로직**(home_org → default_org 폴백)
- [ ] `구독하기` 버튼 / `Unsubscribe` / `Unlink` UI 및 토스트
- [ ] 구독 이벤트 **동기화 트리거**(진입 시 1회 + 수동 **새로고침**)
- [ ] 더미 HRIS 로더(파일 주입/스위치, 시나리오 C: 조기 복귀 포함)
- [ ] `Official` 관리자 전용 편집 UI(기본만, 공통 모달 재사용/Scope=Official 고정)
- [ ] 수용 기준 **T1~T9** E2E 점검

---

## 14) 용어 정리(Glossary)

- **구독(Subscribe)**: 원본 일정을 `My`에 **연결된 상태로 추가** → 원본 변경/취소 자동 반영  
- **연결 해제(Unlink)**: 구독 관계를 끊고, 현재 값을 가진 **독립 일정**으로 전환  
- **더미 HRIS**: 실제 인사 전산을 **파일 데이터**로 모사한 소스  
- **home_org**: 사용자의 기본 소속 팀(`org_code`와 동일). 
