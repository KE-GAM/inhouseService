
{% extends "sidebar_base.html" %}
{% block content %}


<!-- React App Container -->
<div id="nota-office-app" style="min-height: 600px;">
  <div class="text-center p-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">로딩 중...</span>
    </div>
    <p class="mt-3 text-muted">현황판을 불러오는 중...</p>
  </div>
</div>

<!-- React App CSS -->
<link rel="stylesheet" href="/static/deskroom/assets/index.css">

<!-- Load React App -->
<script type="module">
  // Load React app with fixed filenames
  import('/static/deskroom/assets/index.js')
    .catch(() => {
      document.getElementById('nota-office-app').innerHTML = `
        <div class="alert alert-warning" role="alert">
          <h4 class="alert-heading">프론트엔드 로딩 실패</h4>
          <p>React 앱을 로드할 수 없습니다. 다음을 확인해주세요:</p>
          <hr>
          <ul>
            <li>서버가 실행 중인지 확인</li>
            <li>빌드 파일이 올바른 위치에 있는지 확인</li>
            <li>브라우저 콘솔에서 에러 메시지 확인</li>
          </ul>
          <br>
          <h5>임시 현황 확인</h5>
          <button class="btn btn-primary" onclick="checkStatus()">현재 상태 확인</button>
          <div id="status-display" class="mt-3"></div>
        </div>
      `;
    });

  // Fallback status checker
  window.checkStatus = async function() {
    try {
      const response = await fetch('/api/rooms/status');
      const rooms = await response.json();
      
      let html = '<div class="row">';
      rooms.forEach(room => {
        const statusColor = room.status === 'AVAILABLE' ? 'success' : 
                           room.status === 'RESERVED' ? 'warning' : 'danger';
        const statusText = room.status === 'AVAILABLE' ? '사용 가능' :
                          room.status === 'RESERVED' ? '예약됨' : '사용중';
        
        html += `
          <div class="col-md-4 mb-3">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">${room.name}</h6>
                <span class="badge bg-${statusColor}">${statusText}</span>
                <small class="text-muted d-block">${room.type} · 수용: ${room.capacity}명</small>
                ${room.current ? `<small class="text-muted">종료: ${new Date(room.current.until).toLocaleTimeString()}</small>` : ''}
                ${room.next ? `<small class="text-muted">시작: ${new Date(room.next.start).toLocaleTimeString()}</small>` : ''}
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      document.getElementById('status-display').innerHTML = html;
    } catch (error) {
      document.getElementById('status-display').innerHTML = 
        '<div class="alert alert-danger">상태를 불러올 수 없습니다.</div>';
    }
  };
</script>

{% endblock %}
